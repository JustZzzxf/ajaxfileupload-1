$.extend({createUploadIframe:function(e){var t="jUploadFrame"+e;return $("<iframe>").attr({id:t,name:t}).css({top:"-9999px",left:"-9999px",position:"absolute"}).appendTo("body")[0]},createUploadForm:function(e,t){var r="jUploadForm"+e,a="jUploadFile"+e,o=$("#"+t),n=$(o).clone();return $("<form>").attr({id:r,name:r}).append($(o).attr("id",a).before(n)).css({position:"absolute",top:"-1200px",left:"-1200px"}).appendTo("body")[0]},addOtherRequestsToForm:function(e,t){var r=$('<input type="hidden"/>');for(var a in t)r.clone().attr({name:a,value:t[a]}).appendTo(e);return e},ajaxFileUpload:function(e){e=$.extend({},$.ajaxSettings,e);var t=(new Date).getTime(),r=($.createUploadIframe(t),$.createUploadForm(t,e.fileElementId)),a="jUploadFrame"+t,o="jUploadForm"+t,n=!1,l={};e.data&&(r=$.addOtherRequestsToForm(r,e.data)),e.global&&!$.active++&&$.event.trigger("ajaxStart"),e.global&&$.event.trigger("ajaxSend",[l,e]);var c=function(t){var o=$("#"+a)[0];try{var c=o.contentWindow||o.contentDocument;c&&(l.responseText=c.document.body?c.document.body.innerHTML:null,l.responseXML=c.document.XMLDocument?c.document.XMLDocument:c.document)}catch(i){$.handleError(e,l,null,i)}if(l||"timeout"==t){n=!0;var d;try{if(d="timeout"!=t?"success":"error","error"!=d){var u=$.uploadHttpData(l,e.dataType);e.success&&e.success(u,d),e.global&&$.event.trigger("ajaxSuccess",[l,e])}else $.handleError(e,l,d)}catch(i){d="error",$.handleError(e,l,d,i)}e.global&&$.event.trigger("ajaxComplete",[l,e]),e.global&&!--$.active&&$.event.trigger("ajaxStop"),e.complete&&e.complete(l,d),$(o).off(),setTimeout(function(){try{$(o,r).remove()}catch(t){$.handleError(e,l,null,t)}},100),l=null}};e.timeout>0&&setTimeout(function(){n||c("timeout")},e.timeout);try{$("#"+o).attr({action:e.url,method:"POST",target:a,encoding:"multipart/form-data",enctype:"multipart/form-data"}).submit()}catch(i){$.handleError(e,l,null,i)}return $("#"+a).on("load",c),{abort:function(){}}},uploadHttpData:function(e,t){var r=!t;if(r="xml"==t||r?e.responseXML:e.responseText,"script"==t&&$.globalEval(r),"json"==t){var a=/<pre.*?>(.*?)<\/pre>/i;if(a.test(r)){var o=a.exec(r);r=o?o[1]:""}r=$.parseJSON(r)}return"html"==t&&$("<div>").html(r).evalScripts(),r},handleError:function(e,t,r,a){e.error&&e.error.call(e.context||e,t,r,a),e.global&&(e.context?$(e.context):$.event).trigger("ajaxError",[t,e,a])}});
